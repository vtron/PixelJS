if(!Pixel){var Pixel={};if(!px)var px=Pixel}
Pixel.App=new Class({Extends:Pixel.Canvas,Implements:Events,bSetup:!1,bRunning:!0,bIsMobileApp:!1,fps:60,curFPS:0,bShowFPS:!1,nFPSSamples:50,fpsSamples:[],curFpsSample:-1,curFps:0,startTime:0,prevTime:0,initialize:function(){this.parent(Pixel.RENDER_MODE_2D);this.prevTime=this.startTime=(new Date).getTime();$(document.body).addEvent("touchstart",this.touchStartListener.bind(this));$(document.body).addEvent("touchmove",this.touchMovedListener.bind(this));$(document.body).addEvent("touchend",this.touchEndListener.bind(this));
TWEEN.start()},start:function(){this.bRunning=!0},stop:function(){this.bRunning=!1},run:function(){if(this.bRunning){if(this.setup!=void 0&&this.bSetup==!1)this.setup(),this.bSetup=!0;this.update();this.draw();this.bShowFPS&&(this.updateFPS(),this.drawFPS());window.requestAnimFrame(this.run.bind(this))}},setFramerate:function(a){this.fps=a},getFPS:function(){return this.fps},showFPS:function(){for(var a=0;a<this.fpsSamples.length;a++)this.fpsSamples[a]=0;this.bShowFPS=!0},hideFPS:function(){this.bShowFPS=
!1},updateFPS:function(){this.curFpsSample++;if(this.curFpsSample>=this.nFPSSamples)this.curFpsSample=0;var a=this.getElapsedTime();this.fpsSamples[this.curFpsSample]=1E3/(a-this.prevTime);for(var c=0,d=0;d<this.fpsSamples.length;d++)c+=this.fpsSamples[d];c/=this.fpsSamples.length;this.curFps=Math.floor(c);this.prevTime=a},drawFPS:function(){this.setFont("Verdana",10);this.setColor(0,0,0);this.drawText("FPS: "+this.curFps.toFixed(2),20,20);this.setColor(255,255,2550);this.drawText("FPS: "+this.curFps.toFixed(2),
22,22)},getElapsedTime:function(){return(new Date).getTime()-this.startTime},touches:[],touchStartListener:function(a){if(this.touchStart!=void 0)for(var c=0;c<a.changedTouches.length;c++){for(var d=null,e=0;e<this.touches.length;e++)if(this.touches[e]==null){d=e;break}if(d==null)d=this.touches.length;this.touches[d]={id:e,pos:{x:(!this.bPixelDoubling?a.changedTouches[c].pageX:a.changedTouches[c].pageX/2)-this.pos.x,y:(!this.bPixelDoubling?a.changedTouches[c].pageY:a.changedTouches[c].pageY/2)-this.pos.y},
uniqueID:a.changedTouches[c].identifier};this.touchStart(this.touches[d])}},touchMovedListener:function(a){for(var c=0;c<a.changedTouches.length;c++)for(var d=a.changedTouches[c].identifier,e=0;e<this.touches.length;e++)if(this.touches[e]!=null&&d==this.touches[e].uniqueID){this.touches[e].pos={x:(!this.bPixelDoubling?a.changedTouches[c].pageX:a.changedTouches[c].pageX/2)-this.pos.x,y:(!this.bPixelDoubling?a.changedTouches[c].pageY:a.changedTouches[c].pageY/2)-this.pos.y};this.touchMoved(this.touches[e]);
break}},touchEndListener:function(a){for(var c=0;c<a.changedTouches.length;c++)for(var d=a.changedTouches[c].identifier,e=0;e<this.touches.length;e++)if(this.touches[e]!=null&&d==this.touches[e].uniqueID){this.touchEnd(this.touches[e]);this.touches[e]=null;break}}});Pixel||(Pixel={},px||(px=Pixel));
Pixel.Canvas=new Class({Implements:Pixel.Renderer,element:null,pos:{x:0,y:0},width:0,height:0,bPixelDoubling:window.devicePixelRatio>=2,initialize:function(a){this.element=new Element("canvas",{width:this.width,height:this.height,styles:{position:"absolute",top:"0px",left:"0px","-webkit-transform-origin":"0 0 0"}});this.setPos(0,0);this.setSize(50,50);this.setRenderer(this.element,a)},setPos:function(a,c){this.pos.x=a;this.pos.y=c;var d="",d="scale3d("+window.devicePixelRatio+","+window.devicePixelRatio+
",0) ";d+="translate3d("+this.pos.x+"px, "+this.pos.y+"px,0px)";this.element.setStyle("-webkit-transform",d)},setSize:function(a,c,d){this.width=a;this.height=c;this.element.set({width:this.width,height:this.height});d!=void 0&&this.setRenderer(d)},getWidth:function(){return this.width},getHeight:function(){return this.height}});Pixel||(Pixel={},px||(px=Pixel));
Pixel.Color=new Class({r:0,g:0,b:0,a:0,h:0,s:0,l:0,v:0,initialize:function(a,c,d,e){this.set(a,c,d,e)},set:function(a,c,d,e){if(a)this.r=a;if(c)this.g=c;if(d)this.b=d;if(e)this.a=e},setHSL:function(a,c,d,e){if(a)this.h=a;if(c)this.s=g;if(d)this.l=b;if(e)this.a=e},setHSV:function(a,c,d,e){if(a)this.h=a;if(c)this.s=g;if(d)this.l=b;if(e)this.a=e},toHSL:function(){var a=Pixel.rgbToHSL(this.r,this.g,this.b);this.setHSL(a.h,a.s,a.l);return a},toHSV:function(){var a=Pixel.rgbToHSV(this.r,this.g,this.b);
this.setHSV(a.h,a.s,a.v);return a}});Pixel.rgbToHsl=function(a,c,d){a/=255;c/=255;d/=255;var e=Math.max(a,c,d),f=Math.min(a,c,d),h,i=(e+f)/2;if(e==f)h=f=0;else{var j=e-f,f=i>0.5?j/(2-e-f):j/(e+f);switch(e){case a:h=(c-d)/j+(c<d?6:0);break;case c:h=(d-a)/j+2;break;case d:h=(a-c)/j+4}h/=6}return{h:h,s:f,l:i}};
Pixel.hslToRgb=function(a,c,d){a=Pixel.map(a,0,360,0,1);c=Pixel.map(c,0,255,0,1);d=Pixel.map(d,0,255,0,1);if(c==0)d=c=a=d;else var e=function(a,c,d){d<0&&(d+=1);d>1&&(d-=1);return d<1/6?a+(c-a)*6*d:d<0.5?c:d<2/3?a+(c-a)*(2/3-d)*6:a},f=d<0.5?d*(1+c):d+c-d*c,h=2*d-f,d=e(h,f,a+1/3),c=e(h,f,a),a=e(h,f,a-1/3);return{r:d*255,g:c*255,b:a*255}};
Pixel.rgbToHsv=function(a,c,d){a/=255;c/=255;d/=255;var e=Math.max(a,c,d),f=Math.min(a,c,d),h,i=e-f;if(e==f)h=0;else{switch(e){case a:h=(c-d)/i+(c<d?6:0);break;case c:h=(d-a)/i+2;break;case d:h=(a-c)/i+4}h/=6}return{h:h,s:e==0?0:i/e,v:e}};
Pixel.hsvToRgb=function(a,c,d){var a=Pixel.map(a,0,360,0,1),c=Pixel.map(c,0,255,0,1),d=Pixel.map(d,0,255,0,1),e,f,h,i=Math.floor(a*6),j=a*6-i,a=d*(1-c),k=d*(1-j*c),c=d*(1-(1-j)*c);switch(i%6){case 0:e=d;f=c;h=a;break;case 1:e=k;f=d;h=a;break;case 2:e=a;f=d;h=c;break;case 3:e=a;f=k;h=d;break;case 4:e=c;f=a;h=d;break;case 5:e=d,f=a,h=k}return{r:e*255,g:f*255,b:h*255}};Pixel||(Pixel={},px||(px=Pixel));
Pixel.Font=new Class({ctx:null,text:"",font:"Arial",size:50,alignment:Pixel.TEXT_ALIGN_LEFT,baseline:Pixel.TEXT_BASELINE_TOP,initialize:function(a,c,d){if(Pixel.isSet(a))this.font=a;if(Pixel.isSet(c))this.size=c;if(Pixel.isSet(d))this.alignment=d},setSize:function(a){this.size=a},setFont:function(a){this.font=a},setAlignment:function(a){this.alignment=a},setBaseline:function(a){this.baseline=a},setText:function(a){this.text=a},getSize:function(){return this.size}});Pixel||(Pixel={},px||(px=Pixel));
Pixel.Image=new Class({Extends:Pixel.Object,image:null,canvas:null,ctx:null,imageData:null,pixels:null,bAllocated:!1,bLoaded:!1,size:{width:0,height:0},initialize:function(a){a!=void 0&&this.load(a)},load:function(a){this.clear();this.image=new Asset.image(a,{onLoad:function(){this.bLoaded=!0;this.setSize(this.image.width,this.image.height)}.bind(this),onError:function(){console.log("Could not load image from '"+a+"'")}})},isLoaded:function(){return this.bLoaded},clear:function(){this.bLoaded=!1;
this.image=this.imageData=this.pixels=null},setSize:function(a,c){this.parent(a,c);if(this.bAllocated==!1)this.canvas=new Element("canvas"),this.ctx=this.canvas.getContext("2d"),this.imageData=this.ctx.getImageData(0,0,this.getWidth(),this.getHeight());this.canvas.set({width:this.size.width,height:this.size.height})},getImageData:function(){return this.imageData},getPixels:function(){return this.bLoaded?(this.ctx.drawImage(this.image,0,0),this.imageData=this.ctx.getImageData(0,0,this.size.width,this.size.height),
this.pixels=this.imageData.data):null},setFromPixels:function(a,c,d){this.clear();this.setSize(c,d);this.imageData=this.ctx.getImageData(0,0,this.size.width,this.size.height);this.pixels=this.imageData.data;for(c=a.length;c--;)this.pixels[c]=a[c];this.ctx.putImageData(this.imageData,0,0);this.image=new Element("img");this.image.addEvent("load",function(){this.image.removeEvent("load");this.bLoaded=!0}.bind(this));this.image.src=this.canvas.toDataURL("image/png")},draw:function(a,c,d){a.drawImage(this,
c,d)}});Pixel||(Pixel={},px||(px=Pixel));
Pixel.Object=new Class({bInitPressed:!1,bPressed:!1,pos:{x:0,y:0},width:0,height:0,radius:0,shapeMode:Pixel.OBJECT_SHAPE_RECT,tween:null,rect:new Pixel.Rectangle,initialize:function(){},show:function(){},hide:function(){},setPos:function(a,c){if(Pixel.isSet(a))this.pos.x=a;if(Pixel.isSet(c))this.pos.y=c},getPos:function(){return this.pos},setSize:function(a,c){if(Pixel.isSet(a))this.width=a;if(Pixel.isSet(c))this.height=c},getWidth:function(){return this.width},getHeight:function(){return this.height},
setShapeMode:function(a){this.shapeMode=a},isPressed:function(){return this.bPressed},touchStart:function(a){this.rect.set(this.pos.x,this.pos.y,this.width,this.height);switch(this.shapeMode){case Pixel.OBJECT_SHAPE_RECT:this.bInitPressed=this.rect.isInside(a.pos.x,a.pos.y);break;case Pixel.OBJECT_SHAPE_CIRCLE:this.bInitPressed=Pixel.dist(this.pos.x,this.pos.y,a.pos.x,a.pos.y)<this.radius*2}this.bPressed=this.bInitPressed},touchMoved:function(){if(this.bInitPressed)switch(this.shapeMode){case Pixel.OBJECT_SHAPE_RECT:this.bPressed=
this.rect.isInside(touch.pos.x,touch.pos.y);break;case Pixel.OBJECT_SHAPE_CIRCLE:this.bPressed=Pixel.dist(this.pos.x,this.post.y,touch.pos.x,touch.pos.y)<this.radius*2}},touchEnd:function(){this.bInitPressed=this.bPressed=!1}});Pixel||(Pixel={},px||(px=Pixel));Pixel.Spritesheet=new Class({sheet:null,initialize:function(){sheet=new Pixel.Image},load:function(a){sheet.load(a)}});Pixel||(Pixel={},px||(px=Pixel));
Pixel.Renderer=new Class({renderer:null,setRenderer:function(a,c){switch(c){case Pixel.RENDER_MODE_2D:this.renderer=new Pixel.Renderer2D(a);break;case Pixel.RENDER_MODE_WEBGL:Pixel.log("WebGL Renderer not yet implemented!");break;default:Pixel.log("Renderer Type does not exist")}},clear:function(a,c,d,e){this.renderer.clear(a,c,d,e)},setColor:function(a,c,d,e){this.renderer.setColor(a,c,d,e)},fill:function(){this.renderer.fill()},noFill:function(){this.renderer.noFill()},stroke:function(a){this.renderer.stroke(a)},
noStroke:function(){this.renderer.noStroke()},drawImage:function(a,c,d){this.renderer.drawImage(a,c,d)},beginShape:function(a,c){this.renderer.beginShape(a,c)},addVertex:function(a,c,d){this.renderer.addVertex(a,c,d)},endShape:function(a,c){this.renderer.endShape(a,c)},drawLine:function(a,c,d,e){this.renderer.drawLine(a,c,d,e)},drawRect:function(a,c,d,e){this.renderer.drawRect(a,c,d,e)},drawSquare:function(a,c,d){this.renderer.drawSquare(a,c,d)},drawEllipse:function(){this.renderer.drawEllipse()},
drawCircle:function(a,c,d){this.renderer.drawCircle(a,c,d)},pushMatrix:function(){this.renderer.pushMatrix()},popMatrix:function(){this.renderer.popMatrix()},translate:function(a,c){this.renderer.translate(a,c)},scale:function(a,c){this.renderer.scale(a,c)},rotate:function(a){this.renderer.rotate(a)},transform:function(a,c,d,e,f,h){this.renderer.transform(a,c,d,e,f,h)},setTransform:function(a,c,d,e,f,h){this.renderer.setTransform(a,c,d,e,f,h)},setFont:function(a,c){this.renderer.setFont(a,c)},setTextAlignment:function(a){this.renderer.setTextAlignment(a)},
setTextBaseline:function(a){this.renderer.setTextBaseline(a)},getStringWidth:function(a){return this.renderer.getStringWidth(a)},drawText:function(a,c,d){this.renderer.drawText(a,c,d)}});Pixel||(Pixel={},px||(px=Pixel));
Pixel.Renderer2D=new Class({ctx:null,bFill:!0,bStroke:!1,initialize:function(a){this.ctx=a.getContext("2d")},clear:function(a,c,d,e){this.ctx.clearRect(a,c,d,e)},setColor:function(a,c,d,e){a=Math.round(a);c=Math.round(c);d=Math.round(d);c==void 0?(this.ctx.fillStyle="rgb("+a+","+a+","+a+")",this.ctx.strokeStyle="rgb("+a+","+a+","+a+")"):e==void 0?(this.ctx.fillStyle="rgb("+a+","+c+","+d+")",this.ctx.strokeStyle="rgb("+a+","+c+","+d+")"):(this.ctx.fillStyle="rgba("+a+","+c+","+d+","+e+")",this.ctx.strokeStyle=
"rgba("+a+","+c+","+d+","+e+")")},fill:function(){this.bFill=!0},noFill:function(){this.bFill=!1},stroke:function(a){this.bStroke=!0;this.ctx.lineWidth=a},noStroke:function(){this.bStroke=!1},drawImage:function(a,c,d){a.isLoaded()&&(c!=void 0&&d!=void 0?this.ctx.drawImage(a.image,c,d):this.ctx.drawImage(a.image,a.getPos().x,a.getPos().y))},beginShape:function(a,c){this.ctx.beginPath();this.ctx.moveTo(a,c)},addVertex:function(a,c,d){this.ctx.lineTo(a,c);d!=void 0&&this.endShape()},endShape:function(){this.ctx.closePath();
this.ctx.fill()},drawLine:function(a,c,d,e){this.ctx.beginPath();this.ctx.moveTo(a,c);this.ctx.lineTo(d,e);this.ctx.stroke()},drawRect:function(a,c,d,e){this.bFill&&this.ctx.fillRect(a,c,d,e);this.bStroke&&this.ctx.strokeRect(a,c,d,e)},drawSquare:function(a,c,d){this.rectangle(a,c,d,d)},drawEllipse:function(a,c,d,e){ox=d/2*0.5522848;oy=e/2*0.5522848;xe=a+d;ye=c+e;xm=a+d/2;ym=c+e/2;this.ctx.beginPath();this.ctx.moveTo(a,ym);this.ctx.bezierCurveTo(a,ym-oy,xm-ox,c,xm,c);this.ctx.bezierCurveTo(xm+ox,
c,xe,ym-oy,xe,ym);this.ctx.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye);this.ctx.bezierCurveTo(xm-ox,ye,a,ym+oy,a,ym);this.ctx.closePath();this.bStroke&&this.ctx.stroke();this.bFill&&this.ctx.fill()},drawCircle:function(a,c,d){this.ctx.beginPath();this.ctx.arc(a,c,d,0,Math.PI*2,!1);this.bStroke&&this.ctx.stroke();this.bFill&&this.ctx.fill()},pushMatrix:function(){this.ctx.save()},popMatrix:function(){this.ctx.restore()},translate:function(a,c){this.ctx.translate(a,c)},scale:function(a,c){this.ctx.scale(a,
c)},rotate:function(a){this.ctx.rotate(a)},transform:function(a,c,d,e,f,h){this.ctx.transform(a,c,d,e,f,h)},setTransform:function(a,c,d,e,f,h){this.ctx.setTransform(a,c,d,e,f,h)},setFont:function(a,c){c==void 0?this.setFont(a.font,a.size):this.ctx.font=c+"pt "+a;this.setTextAlignment(a.alignment);this.setTextBaseline(a.baseline)},setTextAlignment:function(a){this.ctx.textAlign=a},setTextBaseline:function(a){this.ctx.textBaseline=a},bLogged:!1,getStringWidth:function(a){return this.ctx.measureText(a).width},
drawText:function(a,c,d){this.ctx.fillText(a,c,d)}});Pixel||(Pixel={},px||(px=Pixel));Pixel.RENDER_MODE_2D=0;Pixel.RENDER_MODE_WEBGL=1;Pixel.TEXT_ALIGN_LEFT="left";Pixel.TEXT_ALIGN_CENTER="center";Pixel.TEXT_ALIGN_RIGHT="right";Pixel.TEXT_BASELINE_TOP="top";Pixel.TEXT_BASELINE_HANGING="hanging";Pixel.TEXT_BASELINE_MIDDLE="middle";Pixel.TEXT_BASELINE_BOTTOM="bottom";Pixel.OBJECT_SHAPE_RECT=0;Pixel.OBJECT_SHAPE_CIRCLE=1;Pixel.ORIGIN_TOP_LEFT=0;Pixel.ORIGIN_CENTER_LEFT=1;Pixel.ORIGIN_BOTTOM_LEFT=2;
Pixel.ORIGIN_TOP_RIGHT=3;Pixel.ORIGIN_CENTER_RIGHT=4;Pixel.ORIGIN_BOTTOM_RIGHT=5;Pixel.ORIGIN_TOP_CENTER=6;Pixel.ORIGIN_BOTTOM_CENTER=7;Pixel.ORIGIN_CENTER=8;Pixel.NO_EASE=TWEEN.Easing.Linear.EaseNone;Pixel.EASE_IN_QUAD=TWEEN.Easing.Quadratic.EaseIn;Pixel.EASE_OUT_QUAD=TWEEN.Easing.Quadratic.EaseOut;Pixel.EASE_IN_OUT_QUAD=TWEEN.Easing.Quadratic.EaseInOut;Pixel.EASE_IN_CUBE=TWEEN.Easing.Cubic.EaseIn;Pixel.EASE_OUT_CUBE=TWEEN.Easing.Cubic.EaseOut;Pixel.EASE_IN_OUT_CUBE=TWEEN.Easing.Cubic.EaseInOut;
Pixel.EASE_IN_QUART=TWEEN.Easing.Quartic.EaseIn;Pixel.EASE_OUT_QUART=TWEEN.Easing.Quartic.EaseOut;Pixel.EASE_IN_OUT_QUART=TWEEN.Easing.Quartic.EaseInOut;Pixel.EASE_IN_QUINT=TWEEN.Easing.Quintic.EaseIn;Pixel.EASE_OUT_QUINT=TWEEN.Easing.Quintic.EaseOut;Pixel.EASE_IN_OUT_QUINT=TWEEN.Easing.Quintic.EaseInOut;Pixel.EASE_IN_SIN=TWEEN.Easing.Sinusoidal.EaseIn;Pixel.EASE_OUT_SIN=TWEEN.Easing.Sinusoidal.EaseOut;Pixel.EASE_IN_OUT_SIN=TWEEN.Easing.Sinusoidal.EaseInOut;Pixel.EASE_IN_EXPO=TWEEN.Easing.Exponential.EaseIn;
Pixel.EASE_OUT_EXPO=TWEEN.Easing.Exponential.EaseOut;Pixel.EASE_IN_OUT_EXPO=TWEEN.Easing.Exponential.EaseInOut;Pixel.EASE_IN_CIRC=TWEEN.Easing.Circular.EaseIn;Pixel.EASE_OUT_CIRC=TWEEN.Easing.Circular.EaseOut;Pixel.EASE_IN_OUT_CIRC=TWEEN.Easing.Circular.EaseInOut;Pixel||(Pixel={},px||(px=Pixel));
Pixel.Rectangle=new Class({x:0,y:0,width:0,height:0,initialize:function(a,c,d,e){this.set(a,c,d,e)},set:function(a,c,d,e){this.setPos(a,c);this.setSize(d,e)},setPos:function(a,c){if(Pixel.isSet(a))this.x=a;if(Pixel.isSet(c))this.y=c},setSize:function(a,c){if(Pixel.isSet(a))this.width=a;if(Pixel.isSet(c))this.height=c},getPos:function(){return{x:this.x,y:this.y}},getSize:function(){return{width:this.width,height:this.height}},isInside:function(a,c){return a>this.x&&a<this.x+this.width&&c>this.y&&c<
this.y+this.height}});Pixel.radToDeg=function(a){return a*(180/Math.PI)};Pixel.degToRad=function(a){return a*(Math.PI/180)};Pixel.map=function(a,c,d,e,f,h){a=e+(f-e)*((a-c)/(d-c));return h?Pixel.clamp(a):a};Pixel.clamp=function(a,c,d){a=Math.max(a,c);return a=Math.min(a,d)};Pixel.dist=function(a,c,d,e,f){a=Math.sqrt(Math.pow(d-a,2)+Math.pow(e-c,2));return f?a:Math.abs(a)};Pixel.getAngle=function(a,c,d,e){return Math.atan2(e-c,d-a)};Pixel||(Pixel={},px||(px=Pixel));
Pixel.isSet=function(a){return a!=void 0?a:!1};Pixel.log=function(a){console.log("Pixel: "+a)};window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();
